
<div id="detalhes" style="font-family: sans-serif; padding: 20px;">Carregando detalhes...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCWH18dhHz0EBY5Ycc4wjZ1H6AlO-51sho",
  authDomain: "teste1-66092.firebaseapp.com",
  projectId: "teste1-66092",
  storageBucket: "teste1-66092.firebasestorage.app",
  messagingSenderId: "517435649522",
  appId: "1:517435649522:web:a6826c13b1e2c5062acf6b",
  measurementId: "G-3GVBBV8W7C"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("detalhes");
const colecao = "Dados estud";

// üîπ L√™ o ID do documento da URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

async function carregarDetalhes() {
  if (!id) {
    container.innerHTML = "<p>ID do documento n√£o encontrado.</p>";
    return;
  }

  try {
    const docRef = doc(db, colecao, id);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      container.innerHTML = "<p>Documento n√£o encontrado.</p>";
      return;
    }

    const dados = docSnap.data();

    container.innerHTML = `
      <div style="
        border: 2px solid lime;
        border-radius: 12px;
        background: #111;
        color: white;
        padding: 20px;
        max-width: 500px;
        margin: auto;
      ">
        <h2 style="color: lime; text-align: center;">üìÑ Detalhes do Registro</h2>
        <hr style="border:1px solid lime;margin:10px 0;">
        <div>
          <p><strong>Nome:</strong> <span id="campo-nome">${dados.Nome || ""}</span></p>
          <p><strong>Livro de estudo:</strong> <span id="campo-livro">${dados["Livro de estudo"] || ""}</span></p>
          <p><strong>Cap√≠tulo:</strong> <span id="campo-capitulo">${dados.Cap√≠tulo || ""}</span></p>
          <p><strong>Li√ß√£o:</strong> <span id="campo-licao">${dados.Li√ß√£o || ""}</span></p>
        </div>
        <br>
        <button id="editar" style="background: orange; color: black; font-weight:bold; border:none; border-radius:8px; padding:10px 16px; cursor:pointer; margin-right:8px;">‚úèÔ∏è Editar</button>
        <button id="salvar" style="background: lime; color:black; font-weight:bold; border:none; border-radius:8px; padding:10px 16px; cursor:pointer; margin-right:8px; display:none;">üíæ Salvar altera√ß√µes</button>
        <button id="excluir" style="background:red;color:white;font-weight:bold;border:none;border-radius:8px;padding:10px 16px; cursor:pointer;">üóëÔ∏è Excluir</button>
      </div>
    `;

    const btnEditar = document.getElementById("editar");
    const btnSalvar = document.getElementById("salvar");
    const btnExcluir = document.getElementById("excluir");

    btnEditar.addEventListener("click", () => ativarEdicao());
    btnSalvar.addEventListener("click", () => salvarEdicao());
    btnExcluir.addEventListener("click", () => excluirDocumento());

  } catch (erro) {
    container.innerHTML = `<p style="color:red;">Erro ao carregar detalhes: ${erro.message}</p>`;
  }
}

// Editar campos
function ativarEdicao() {
  ["nome","livro","capitulo","licao"].forEach(c => {
    const span = document.getElementById(`campo-${c}`);
    const input = document.createElement("input");
    input.id = `input-${c}`;
    input.value = span.textContent;
    input.style.width = "100%";
    input.style.padding = "6px";
    input.style.margin = "4px 0";
    input.style.borderRadius = "4px";
    span.replaceWith(input);
  });

  document.getElementById("editar").style.display = "none";
  document.getElementById("salvar").style.display = "inline-block";
}

// Salvar edi√ß√£o
async function salvarEdicao() {
  const novosDados = {
    Nome: document.getElementById("input-nome").value,
    "Livro de estudo": document.getElementById("input-livro").value,
    Cap√≠tulo: document.getElementById("input-capitulo").value,
    Li√ß√£o: document.getElementById("input-licao").value
  };

  try {
    await updateDoc(doc(db, colecao, id), novosDados);
    alert("‚úÖ Dados atualizados com sucesso!");
    carregarDetalhes();
  } catch (erro) {
    alert("‚ùå Erro ao atualizar: " + erro.message);
  }
}

// Excluir documento
async function excluirDocumento() {
  if (!confirm("Tem certeza que deseja excluir este registro?")) return;

  try {
    await deleteDoc(doc(db, colecao, id));
    alert("‚úÖ Documento exclu√≠do com sucesso!");
    window.close();
  } catch (erro) {
    alert("‚ùå Erro ao excluir: " + erro.message);
  }
}

carregarDetalhes();
</script>

