
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formul√°rio estudante</title>
</head>
<body>
  
  <style>
  /* üîπ Zera margens e paddings globais */
  html, body {
    margin: 0;
   width: 100%;
  }
</style>
  

<div id="container"></div>
<div id="rodapeContainer"></div>
<div id="mensagem"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// üîπ Configura√ß√£o Firebase
const firebaseConfig = {
  apiKey: "SUA_API_KEY_AQUI",
  authDomain: "teste1-66092.firebaseapp.com",
  projectId: "teste1-66092",
  storageBucket: "teste1-66092.firebasestorage.app",
  messagingSenderId: "517435649522",
  appId: "1:517435649522:web:a6826c13b1e2c5062acf6b",
  measurementId: "G-3GVBBV8W7C"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("container");
const rodapeContainer = document.getElementById("rodapeContainer");
const msgDiv = document.getElementById("mensagem");

const paginas = ["Formu estudante"];

// üîπ Fun√ß√£o para aplicar estilos
function aplicarEstilos(elemento, estilos){
  estilos.forEach(linha => {
    const [chave, valor] = linha.replace(/[{}]/g, "").split(":").map(s => s.trim());
    if(!chave || !valor) return;

    switch(chave.toLowerCase()){
      case "cor":
        elemento.style.color = valor;
        break;

      case "cor-fundo":
        elemento.style.backgroundColor = valor;
        break;

      case "tamanho":
        elemento.style.fontSize = valor + "px";
        break;

      case "fonte":
        if(valor.toLowerCase() === "negrito") elemento.style.fontWeight = "bold";
        break;

      case "espa√ßo-top":
        elemento.style.marginTop = valor + "px";
        break;

      case "posi√ß√£o":
        if(valor.toLowerCase() === "centro") elemento.style.textAlign = "center";
        else if(valor.toLowerCase() === "direita") elemento.style.textAlign = "right";
        else elemento.style.textAlign = "left";
        break;

      case "padding":
        elemento.style.padding = valor + "px";
        break;

      case "borda":
        elemento.style.borderRadius = valor + "px";
        break;

      case "largura":
        elemento.style.width = (valor.includes("%") || valor.includes("px") || valor === "auto") ? valor : valor + "px";
        if(valor === "0%"){
          elemento.style.marginLeft = "0";
          elemento.style.marginRight = "0";
          elemento.style.display = "block";
        }
        break;

      case "margin-left":
        elemento.style.marginLeft = valor + "px";
        break;

      case "margin-right":
        elemento.style.marginRight = valor + "px";
        break;

      case "borda-solid":
        elemento.style.borderStyle = "solid";
        elemento.style.borderWidth = "1px";
        elemento.style.borderColor = valor;
        break;

      default:
        break;
    }
  });
}

// üîπ Processa blocos [stylo]
function processarEstilos(codigo){
  const estiloMap = {};
  const styloRegex = /\[stylo\]([\s\S]*?)\[stylo\]/gi;
  let styloMatch;
  while((styloMatch = styloRegex.exec(codigo)) !== null){
    const bloco = styloMatch[1];
    ["logo","titulo","subtitulo","texto","formul√°rio","nome","input","rodape","bot√£o"].forEach(el => {
      const regex = new RegExp(`\\[${el}\\]([\\s\\S]*?)\\[${el}\\]`, "gi");
      let matchEl;
      while((matchEl = regex.exec(bloco)) !== null){
        const linhas = matchEl[1].split("\n").map(l => l.trim()).filter(l => l.startsWith("{"));
        estiloMap[el] = linhas;
      }
    });
  }
  return estiloMap;
}

// üîπ Interpreta o c√≥digo Lopixecodin
function interpretarCodigo(codigo, estiloMap){
  codigo = codigo.replace(/\[stylo\][\s\S]*?\[stylo\]/gi,""); // remove [stylo]

  const blocoContainer = document.createElement("div");
  blocoContainer.classList.add("conteudo-gerada");
  blocoContainer.style.width = "92.30%";
  blocoContainer.style.margin = "0";
  blocoContainer.style.padding = "0";

  // üîπ Texto simples: logo, titulo, subtitulo, texto
  const blocos = [
    { regex: /\[logo\]([\s\S]*?)\[logo\]/gi, tag:"h1", key:"logo" },
    { regex: /\[titulo\]([\s\S]*?)\[titulo\]/gi, tag:"h2", key:"titulo" },
    { regex: /\[subtitulo\]([\s\S]*?)\[subtitulo\]/gi, tag:"h3", key:"subtitulo" },
    { regex: /\[texto\]([\s\S]*?)\[texto\]/gi, tag:"p", key:"texto" }
  ];

  for(const bloco of blocos){
    let match;
    while((match = bloco.regex.exec(codigo)) !== null){
      const el = document.createElement(bloco.tag);
      el.textContent = match[1].trim();
      el.style.margin = "0";
      if(estiloMap[bloco.key]) aplicarEstilos(el, estiloMap[bloco.key]);
      blocoContainer.appendChild(el);
    }
  }

  // üîπ Formul√°rio
  const formRegex = /\[formul√°rio\]([\s\S]*?)\[formul√°rio\]/gi;
  let matchForm;
  while((matchForm = formRegex.exec(codigo)) !== null){
    const linhas = matchForm[1].trim()
      .split("\n")
      .map(l => l.trim())
      .filter(l => l && !l.startsWith("{"));
    const form = document.createElement("form");
    form.style.margin = "0";
    if(estiloMap["formul√°rio"]) aplicarEstilos(form, estiloMap["formul√°rio"]);

    for(let i = 0; i < linhas.length; i += 3){
      const nomeCampo = linhas[i]?.replace(/\[:|:\]/g,"");
      const inputLinha = linhas[i+1];
      const tipoLinha = linhas[i+2];
      if(!nomeCampo || !inputLinha || !tipoLinha) continue;

      const fieldWrapper = document.createElement("div");
      fieldWrapper.style.display = "flex";
      fieldWrapper.style.flexDirection = "column";
      fieldWrapper.style.marginBottom = "10px";

      const label = document.createElement("label");
      label.textContent = nomeCampo;
      if(estiloMap["nome"]) aplicarEstilos(label, estiloMap["nome"]);

      const input = document.createElement("input");
      const placeholder = (inputLinha.match(/\[:input:(.*?)\]/i)?.[1]||"").trim();
      const obrigatorio = inputLinha.includes("[A√ß√£o:obrigat√≥rio]");
      const tipo = (tipoLinha.match(/\[:tipo-(.*?)\]/i)?.[1]||"text").trim();
      input.type = tipo==="numero"?"number":"text";
      input.placeholder = placeholder;
      input.required = obrigatorio;
      input.name = nomeCampo;
      input.style.width = "0%";
      if(estiloMap["input"]) aplicarEstilos(input, estiloMap["input"]);

      fieldWrapper.appendChild(label);
      fieldWrapper.appendChild(input);
      form.appendChild(fieldWrapper);
    }

    blocoContainer.appendChild(form);
  }

  // üîπ Fun√ß√£o do bot√£o
  const funcRegex = /\[fun√ß√£o\]([\s\S]*?)\[fun√ß√£o\]/gi;
  let funcMatch;
  while((funcMatch = funcRegex.exec(codigo)) !== null){
    const blocoFunc = funcMatch[1];
    const btnMatch = blocoFunc.match(/\[bot√£o-publicar:\s*(.*?)\]/i);
    const colecaoMatch = blocoFunc.match(/\[cole√ß√£o__(.*?)\]/i);
    const msgMatch = blocoFunc.match(/\[mensagem:\s*(.*?)\]/i);
    if(!btnMatch) continue;

    const textoBotao = btnMatch[1].trim();
    const colecaoNome = colecaoMatch? colecaoMatch[1].trim():"Dados";
    const mensagemSucesso = msgMatch? msgMatch[1].trim():"Dados salvos com sucesso!";

    const btn = document.createElement("button");
    btn.type="button";
    btn.textContent = textoBotao;
    btn.style.display="block";
    btn.style.marginTop="10px";

    // üîπ Aplica estilos do [bot√£o] se existir
    if(estiloMap["bot√£o"]) aplicarEstilos(btn, estiloMap["bot√£o"]);

    btn.addEventListener("click", async ()=>{
      const form = blocoContainer.querySelector("form");
      if(!form) return;
      const dados = {};
      form.querySelectorAll("input").forEach(inp => dados[inp.name] = inp.value);
      try{
        const id = "doc_"+Date.now();
        await setDoc(doc(db, colecaoNome, id), {...dados, criadoEm: serverTimestamp()});
        msgDiv.style.color="green";
        msgDiv.textContent="‚úÖ "+mensagemSucesso;
        form.reset();
        setTimeout(()=>msgDiv.textContent="",3000);
      }catch(err){
        msgDiv.style.color="red";
        msgDiv.textContent="‚ùå Erro ao salvar na cole√ß√£o "+colecaoNome;
      }
    });

    blocoContainer.appendChild(btn);
  }

  return blocoContainer;
}

// üîπ Renderiza rodap√©
function renderRodape(codigo, estiloMap){
  rodapeContainer.innerHTML="";
  const rodapeRegex = /\[rodape\]([\s\S]*?)\[rodape\]/gi;
  let match;
  while((match = rodapeRegex.exec(codigo)) !== null){
    const rodapeEl = document.createElement("div");
    const textoLimpo = match[1].split("\n").map(l => l.trim()).filter(l => !l.startsWith("{")).join("\n");
    rodapeEl.textContent = textoLimpo;
    if(estiloMap["rodape"]) aplicarEstilos(rodapeEl, estiloMap["rodape"]);
    rodapeContainer.appendChild(rodapeEl);
  }
}

// üîπ Carrega p√°ginas do Firebase
function carregarPaginas(){
  container.innerHTML="";
  for(const nome of paginas){
    const colecaoRef = collection(db, nome);
    onSnapshot(colecaoRef, snapshot => {
      container.innerHTML="";
      snapshot.forEach(docSnap => {
        const dados = docSnap.data();
        const codigo = dados.conteudo || dados.codigo || "";
        const estiloMap = processarEstilos(codigo);
        const bloco = interpretarCodigo(codigo, estiloMap);
        container.appendChild(bloco);
        renderRodape(codigo, estiloMap);
      });
    });
  }
}

carregarPaginas();
</script>
